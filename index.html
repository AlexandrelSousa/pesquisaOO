<!doctype html>
<html lang="pt-BR">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Pesquisa: curiosidades sobre o funcionamento do computador</title>
    <link rel="icon" href="icon.png" type="image/png">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --green: #0eaa62;
            --black: #000000;
            --bg: #0f1720;
            /* slightly off-black */
            --card: #0b0b0b;
            --muted: #9aa3a8;
            --radius: 12px;
        }

        * {
            box-sizing: border-box
        }

        html,
        body {
            height: 100%;
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
            margin: 0;
            min-height: 100%;
            background: linear-gradient(180deg, #071015 0%, #081219 60%);
            color: #e6eef0;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            padding: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .wrap {
            width: 100%;
            max-width: 920px;
        }

        header {
            background: linear-gradient(90deg, var(--black) 0%, rgba(14, 170, 98, 0.12) 100%);
            border-radius: var(--radius);
            padding: 20px 22px;
            display: flex;
            gap: 16px;
            align-items: center;
            box-shadow: 0 6px 20px rgba(2, 6, 8, 0.6);
            margin-bottom: 18px;
        }

        .logo {
            width: 56px;
            height: 56px;
            border-radius: 10px;
            background: var(--green);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--black);
            font-weight: 700;
            font-size: 22px;
            box-shadow: 0 4px 12px rgba(14, 170, 98, 0.18)
        }

        header h1 {
            margin: 0;
            font-size: 1.15rem;
            line-height: 1.1
        }

        header p {
            margin: 0;
            color: var(--muted);
            font-size: 0.95rem
        }

        .card {
            background: rgba(255, 255, 255, 0.02);
            border-radius: var(--radius);
            padding: 16px;
            box-shadow: 0 6px 18px rgba(2, 6, 8, 0.5);
            margin-bottom: 16px;
            border: 1px solid rgba(255, 255, 255, 0.03);
        }

        .guide {
            color: var(--muted);
            margin-top: 6px;
        }

        /* list */
        .list {
            display: flex;
            flex-direction: column;
            gap: 10px
        }

        .item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            padding: 12px;
            border-radius: 10px;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.01), rgba(255, 255, 255, 0.015));
            border: 1px solid rgba(255, 255, 255, 0.02);
        }

        .item .left {
            flex: 1
        }

        .item .title {
            font-size: 0.98rem;
            font-weight: 600;
            color: #eaf6f0
        }

        .item .meta {
            font-size: 0.86rem;
            color: var(--muted);
            margin-top: 6px
        }

        .controls {
            display: flex;
            align-items: center;
            gap: 10px
        }

        .like-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.06);
            background: transparent;
            color: var(--green);
            cursor: pointer;
            font-weight: 600;
            min-width: 90px;
            justify-content: center
        }

        .like-btn[disabled] {
            opacity: 0.5;
            cursor: default
        }

        .like-count {
            font-weight: 700;
            color: #dff9ec;
            min-width: 32px;
            text-align: center
        }

        /* add row */
        .add-row {
            display: flex;
            gap: 10px;
            margin-top: 12px
        }

        .input {
            flex: 1;
            background: transparent;
            border: 1px dashed rgba(255, 255, 255, 0.04);
            padding: 12px;
            border-radius: 10px;
            color: inherit;
            font-size: 1rem
        }

        .btn-add {
            background: var(--green);
            color: var(--black);
            border: none;
            padding: 0 14px;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            min-width: 48px;
            height: 44px
        }

        footer {
            margin-top: 10px;
            color: var(--muted);
            font-size: 0.85rem;
            text-align: center
        }

        .img-logo {
            width: 128px;
            aspect-ratio: square;
        }

        @media (max-width:600px) {
            header {
                padding: 14px
            }

            .logo {
                width: 48px;
                height: 48px;
                font-size: 20px
            }

            .item {
                padding: 10px
            }

            .title {
                font-size: 0.95rem
            }

        }
    </style>
</head>

<body>
    <div class="wrap">
        <img src="./logo.png" class="logo" alt="">
        <header>
            <div class="logo">
            </div>
            <div>
                <h1>Qual a sua maior curiosidade sobre o funcionamento do computador?</h1>
                <p class="guide">Você pode marcar uma das curiosidades aqui ou adicionar uma nova.</p>
            </div>
        </header>

        <main class="card" id="main-card">
            <div id="list" class="list" aria-live="polite"></div>

            <div class="add-row">
                <input id="new-text" class="input" type="text" placeholder="Adicione uma nova curiosidade..."
                    aria-label="Nova curiosidade" />
                <button id="add-btn" class="btn-add" title="Adicionar">+</button>
            </div>

            <footer>
                <small>Pesquisa para desenvolvimento do jogo — cores do projeto: verde e preto.</small>
            </footer>
        </main>
    </div>

    <script>
        // ----- CONFIGURE AQUI -----
        const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbwT6paQrn-ut2FgEBZB8Q6v_en4m4Gvv555XMbEj9uxO3OBAYizO1GfthMGoh0hNM4i/exec'; // substitua
        const IP_API = 'https://api.ipify.org?format=json';

        // ----- UTIL -----
        function el(q) { return document.querySelector(q) }
        function createItem(cur) {
            const div = document.createElement('div');
            div.className = 'item';
            div.dataset.id = cur.id;

            const left = document.createElement('div'); left.className = 'left';
            const title = document.createElement('div'); title.className = 'title'; title.textContent = cur.text || '';
            const meta = document.createElement('div'); meta.className = 'meta'; meta.textContent = cur.created_at ? new Date(cur.created_at).toLocaleString() : '';
            left.appendChild(title); left.appendChild(meta);

            const controls = document.createElement('div'); controls.className = 'controls';

            const btn = document.createElement('button'); btn.className = 'like-btn'; btn.dataset.id = cur.id; btn.setAttribute('aria-label', 'Curtir');
            const spanIcon = document.createElement('span'); spanIcon.textContent = '❤'; spanIcon.style.fontSize = '14px';
            const spanText = document.createElement('span'); spanText.textContent = 'Curtir';
            btn.appendChild(spanIcon); btn.appendChild(spanText);

            const count = document.createElement('div'); count.className = 'like-count'; count.id = 'count-' + cur.id; count.textContent = (cur.likes_count || 0);

            controls.appendChild(btn); controls.appendChild(count);

            div.appendChild(left); div.appendChild(controls);

            return div;
        }

        // ----- FETCH LIST -----
        async function loadList() {
            try {
                const res = await fetch(WEB_APP_URL + '?action=list');
                const json = await res.json();
                const list = el('#list');
                list.innerHTML = '';
                if (json && Array.isArray(json.curiosities)) {
                    // order by likes desc then created
                    const items = json.curiosities.slice().sort((a, b) => (Number(b.likes_count || 0) - Number(a.likes_count || 0)) || new Date(b.created_at) - new Date(a.created_at));
                    items.forEach(c => {
                        const node = createItem(c);
                        list.appendChild(node);
                    });
                    attachLikeEvents();
                } else {
                    list.innerHTML = '<div class="meta" style="color:var(--muted);padding:12px">Nenhuma curiosidade encontrada.</div>';
                }
            } catch (e) {
                console.error('Erro loadList', e);
                el('#list').innerHTML = '<div class="meta" style="color:var(--muted);padding:12px">Erro ao carregar. Tente novamente.</div>';
            }
        }

        function attachLikeEvents() {
            document.querySelectorAll('.like-btn').forEach(btn => {
                const id = btn.dataset.id;
                btn.onclick = onLikeClick;
                if (localStorage.getItem('liked_' + id)) {
                    btn.disabled = true; btn.querySelector('span:nth-child(2)').textContent = 'Já marcou';
                } else { btn.disabled = false; btn.querySelector('span:nth-child(2)').textContent = 'Curtir'; }
            });
        }

        async function getIp() {
            try { const r = await fetch(IP_API); const j = await r.json(); return j.ip || '' } catch (e) { return '' }
        }

        async function onLikeClick(e) {
            const btn = e.currentTarget; const id = btn.dataset.id; btn.disabled = true; btn.querySelector('span:nth-child(2)').textContent = 'Enviando...';
            if (localStorage.getItem('liked_' + id)) { btn.querySelector('span:nth-child(2)').textContent = 'Já marcou'; return; }
            const ip = await getIp();
            try {
                const resp = await fetch(WEB_APP_URL + '?action=like', {
                    method: 'POST',
                    body: new URLSearchParams({ curiosityId: id, ip: ip })
                });
                const j = await resp.json();
                if (j.status === 'ok') {
                    const count = document.getElementById('count-' + id);
                    if (count) count.textContent = j.new_count;
                    localStorage.setItem('liked_' + id, '1');
                    btn.querySelector('span:nth-child(2)').textContent = 'Já marcou';
                } else if (j.status === 'already_liked') {
                    localStorage.setItem('liked_' + id, '1');
                    btn.querySelector('span:nth-child(2)').textContent = 'Já marcou';
                } else {
                    console.warn('like resposta', j);
                    btn.querySelector('span:nth-child(2)').textContent = 'Erro';
                    setTimeout(() => { if (!localStorage.getItem('liked_' + id)) { btn.disabled = false; btn.querySelector('span:nth-child(2)').textContent = 'Curtir'; } }, 1500);
                }
            } catch (err) { console.error('like error', err); btn.querySelector('span:nth-child(2)').textContent = 'Erro'; setTimeout(() => { if (!localStorage.getItem('liked_' + id)) { btn.disabled = false; btn.querySelector('span:nth-child(2)').textContent = 'Curtir'; } }, 1500); }
        }

        // ----- ADD -----
        async function addCuriosity() {
            const input = el('#new-text'); const text = (input.value || '').trim(); if (!text) return;
            const btn = el('#add-btn'); btn.disabled = true; btn.textContent = '+';
            try {
                const resp = await fetch(WEB_APP_URL + '?action=add', {
                    method: 'POST',
                    body: new URLSearchParams({ text: text })
                });
                const j = await resp.json();
                if (j.status === 'ok') {
                    input.value = '';
                    await loadList();
                } else {
                    console.warn('add resposta', j);
                    alert('Erro ao adicionar: ' + (j.error || 'Resposta inesperada'));
                }
            } catch (e) { console.error('add error', e); alert('Erro ao enviar.'); }
            btn.disabled = false; btn.textContent = '+';
        }

        el('#add-btn').addEventListener('click', addCuriosity);
        el('#new-text').addEventListener('keypress', function (e) { if (e.key === 'Enter') addCuriosity(); });

        // init
        loadList();
    </script>
</body>

</html>